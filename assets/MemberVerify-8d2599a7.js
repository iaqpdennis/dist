import{k as E,u as $,r as i,c as l,d as c,e as m,f as a,q as B,i as p,z as y,A as w,p as b,y as x,t as N,x as R,h as z,J as A,E as P}from"./index-2cc77167.js";import{_ as T}from"./FormOtp-2c42f138.js";const j=a("div",{class:"text-center"},[a("div",{class:"mt-12"},[a("h2",{class:"text-2xl font-semibold text-slate-600 dark:text-navy-100"},"Verify Email"),a("p",{class:"text-slate-400 dark:text-navy-200"}," Please enter the 6 digit code sent to your email. ")])],-1),G={class:"mt-10"},O=["onSubmit"],q={class:"mt-2 text-center text-xs sm:text-sm"},F={key:0,class:"mt-1 text-center font-medium"},J=["disabled"],L={class:"mt-5 flex flex-col items-center justify-end gap-4 sm:flex-row"},Q={__name:"MemberVerify",setup(U){const g=A(),e=E(),d=$(),n=i([]),u=i(!1),r=i(60),s=i(!1);let f;const v=l(()=>{var t,o;return(o=(t=e.newMember)==null?void 0:t.personalInfo)==null?void 0:o.email}),h=l(()=>({email:v.value,otp:n.value.join("")})),M=l(()=>{for(const t of n.value)if(t==null||t==null)return!1;return!0}),k=l(()=>({personal_info:{...e.newMember.personalInfo,password:{password:e.decryptData(e.newMember.personalInfo.password.password),password_confirmation:e.decryptData(e.newMember.personalInfo.password.password_confirmation)}},company_name:e.newMember.personalInfo.company_name,company_website:e.newMember.personalInfo.company_website,plan_detail_id:e.newMember.selectedPlan.id,stripe_payment_method:e.newMember.paymentMethod,country_id:e.newMember.country_id,timezone_id:e.newMember.timezone_id,coupon_code:e.newMember.selectedPlan.coupon_code,selected_sensors:e.newMember.selectedDevices,receive_newsletter:e.newMember.personalInfo.receive_newsletter}));async function _(){try{s.value=!0,await d.verifyGuestEmailOtp(h.value),await C(),s.value=!1}catch({message:t}){s.value=!1,$notification({text:t,variant:"error",position:"center-top",duration:5e3})}}async function V(){try{n.value=[],await d.sendGuestEmailOtp({email:v.value}),u.value=!0,$notification({text:"Code was resent successfully.",variant:"success",position:"center-top",duration:5e3}),I()}catch({message:t}){$notification({text:t,variant:"error",position:"center-top",duration:5e3})}}function I(){f=setInterval(()=>{if(r.value--,r.value===0){clearInterval(f),r.value=60,u.value=!1;return}},1e3)}async function C(){try{await d.registerMember(k.value),g.replace("/register/complete")}catch({message:t}){s.value=!1,$notification({text:t,variant:"error",position:"center-top",duration:5e3})}}return(t,o)=>{const D=P("Icon");return c(),m("div",null,[j,a("div",G,[a("form",{onSubmit:B(_,["prevent"])},[p(T,{modelValue:n.value,"onUpdate:modelValue":o[0]||(o[0]=S=>n.value=S),"digit-count":6,onVerifyAuth:_},null,8,["modelValue"]),a("div",q,[y(" Didn't get a code? "),u.value?(c(),m("span",F," Try again in "+w(r.value)+" seconds. ",1)):(c(),m("button",{key:1,type:"button",class:"text-success hover:text-success-focus hover:underline disabled:pointer-events-none disabled:text-slate-400",disabled:s.value,onClick:V}," Resend Code ",8,J))]),a("div",L,[p(x,{mode:"outline-default","is-link":"",link:"/register/payment",class:"order-2 w-full sm:order-1 sm:w-auto",disabled:s.value},{default:b(()=>[y(" Back ")]),_:1},8,["disabled"]),p(x,{type:"submit",class:"order-1 w-full sm:order-2 sm:w-auto",mode:"primary",disabled:!z(M)||s.value},{default:b(()=>[s.value?(c(),N(D,{key:0,icon:"gg:spinner",class:"animate-spin text-base"})):R("",!0),a("span",null,w(s.value?"Verifying...":"Verify"),1)]),_:1},8,["disabled"])])],40,O)])])}}};export{Q as default};
