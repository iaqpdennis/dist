import{k as F,r as s,c as S,b as L,d as l,e as p,f as e,i as n,A as f,p as u,t as x,z as y,B as M,x as g,T as A,q as P,y as B,h as z,J,E as O}from"./index-2cc77167.js";import{u as U}from"./login-1fb07e85.js";import{_ as W}from"./FormOtp-2c42f138.js";const Y={class:"text-center"},G={class:"mt-4"},H=e("h2",{class:"text-xl font-semibold text-slate-600 dark:text-navy-100 sm:text-2xl"}," Please check your email. ",-1),K={class:"text-xs text-slate-400 dark:text-navy-300 sm:text-sm"},Q={class:"mt-6"},X=e("p",null,"Code was resent successfully.",-1),Z=e("p",null,"You may request another code after one minute.",-1),ee=["onSubmit"],te={class:"mt-2 text-center text-xs sm:text-sm"},se={key:0,class:"mt-1 text-center font-medium"},ae=["disabled"],oe={class:"mt-5 flex flex-col items-center justify-center gap-4 sm:flex-row"},ce={__name:"TwoFactorAuth",setup(le){const E=J(),I=F(),b=U(),c=s(null),r=s([]),a=s(!1),v=s(!1),_=s(!1),i=s(60),o=s(!1),d=s("");let m,h;const D=S(()=>{for(const t of r.value)if(t==null||t==null)return!1;return!0}),N=S(()=>({otp:r.value.join(""),...c.value}));L(()=>{c.value=I.getMemberCredentials});async function k(){try{clearTimeout(m),a.value=!0,o.value=!1;const t=await b.verifyAuth(N.value);if(typeof t=="string"){location.href=t;return}E.go()}catch({message:t}){a.value=!1,o.value=!0,d.value=t,w()}}async function R(){try{r.value=[],clearTimeout(m),clearInterval(h),o.value=!1,await b.sendEmailOTP({email:c.value.email}),v.value=!0,_.value=!0,$(),j()}catch({message:t}){o.value=!0,d.value=t,w()}}function w(){m=setTimeout(()=>{o.value=!1,d.value=""},5e3)}function $(){m=setTimeout(()=>{_.value=!1},5e3)}function j(){h=setInterval(()=>{if(i.value--,i.value===0){clearInterval(h),i.value=60,v.value=!1;return}},1e3)}return(t,T)=>{var C;const V=O("Icon");return l(),p("div",null,[e("div",Y,[n(V,{icon:"fluent-mdl2:passive-authentication",class:"mx-auto h-20 w-20 text-success"}),e("div",G,[H,e("p",K," We've sent a code to "+f((C=c.value)==null?void 0:C.email),1)])]),e("div",Q,[n(A,{name:"fade"},{default:u(()=>[o.value?(l(),x(M,{key:0,mode:"error",class:"mb-5"},{default:u(()=>[y(f(d.value),1)]),_:1})):g("",!0)]),_:1}),n(A,{name:"fade"},{default:u(()=>[_.value?(l(),x(M,{key:0,mode:"success",class:"mb-5 flex-col"},{default:u(()=>[X,Z]),_:1})):g("",!0)]),_:1}),e("form",{onSubmit:P(k,["prevent"])},[n(W,{modelValue:r.value,"onUpdate:modelValue":T[0]||(T[0]=q=>r.value=q),"digit-count":6,onVerifyAuth:k},null,8,["modelValue"]),e("div",te,[y(" Didn't get a code? "),v.value?(l(),p("span",se," Try again in "+f(i.value)+" seconds. ",1)):(l(),p("button",{key:1,type:"button",class:"text-success hover:text-success-focus hover:underline disabled:pointer-events-none disabled:text-slate-400",disabled:a.value,onClick:R}," Resend Code ",8,ae))]),e("div",oe,[n(B,{mode:"outline-default","is-link":"",link:"/login",class:"order-2 w-full sm:order-1 sm:w-auto"},{default:u(()=>[y(" Cancel ")]),_:1}),n(B,{type:"submit",class:"order-1 w-full sm:order-2 sm:w-auto",mode:"primary",disabled:!z(D)||a.value},{default:u(()=>[a.value?(l(),x(V,{key:0,icon:"gg:spinner",class:"animate-spin text-base"})):g("",!0),e("span",null,f(a.value?"Verifying...":"Verify"),1)]),_:1},8,["disabled"])])],40,ee)])])}}};export{ce as default};
